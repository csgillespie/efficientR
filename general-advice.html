<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Efficient R programming</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Efficient R programming">
  <meta name="generator" content="bookdown 0.0.70 and GitBook 2.6.7">

  <meta property="og:title" content="Efficient R programming" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="figures/full.png" />
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Efficient R programming" />
  
  
  <meta name="twitter:image" content="figures/full.png" />

<meta name="author" content="Colin Gillespie and Robin Lovelace">

<meta name="date" content="2016-05-04">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="programming.html">
<link rel="next" href="factors.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Efficient R programming</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction (Place holder page for preface)</a><ul>
<li class="chapter" data-level="1.1" data-path="package-dependencies.html"><a href="package-dependencies.html"><i class="fa fa-check"></i><b>1.1</b> Package Dependencies</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="efficient-set-up.html"><a href="efficient-set-up.html"><i class="fa fa-check"></i><b>2</b> Efficient set-up</a><ul>
<li class="chapter" data-level="2.1" data-path="top-5-tips-for-an-efficient-r-set-up.html"><a href="top-5-tips-for-an-efficient-r-set-up.html"><i class="fa fa-check"></i><b>2.1</b> Top 5 tips for an efficient R set-up</a></li>
<li class="chapter" data-level="2.2" data-path="operating-system.html"><a href="operating-system.html"><i class="fa fa-check"></i><b>2.2</b> Operating system</a><ul>
<li class="chapter" data-level="2.2.1" data-path="operating-system.html"><a href="operating-system.html#operating-system-and-resource-monitoring"><i class="fa fa-check"></i><b>2.2.1</b> Operating system and resource monitoring</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="r-version.html"><a href="r-version.html"><i class="fa fa-check"></i><b>2.3</b> R version</a><ul>
<li class="chapter" data-level="2.3.1" data-path="r-version.html"><a href="r-version.html#installing-r"><i class="fa fa-check"></i><b>2.3.1</b> Installing R</a></li>
<li class="chapter" data-level="2.3.2" data-path="r-version.html"><a href="r-version.html#updating-r"><i class="fa fa-check"></i><b>2.3.2</b> Updating R</a></li>
<li class="chapter" data-level="2.3.3" data-path="r-version.html"><a href="r-version.html#installing-r-packages"><i class="fa fa-check"></i><b>2.3.3</b> Installing R packages</a></li>
<li class="chapter" data-level="2.3.4" data-path="r-version.html"><a href="r-version.html#deps"><i class="fa fa-check"></i><b>2.3.4</b> Installing R packages with dependencies</a></li>
<li class="chapter" data-level="2.3.5" data-path="r-version.html"><a href="r-version.html#updating-r-packages"><i class="fa fa-check"></i><b>2.3.5</b> Updating R packages</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="r-startup.html"><a href="r-startup.html"><i class="fa fa-check"></i><b>2.4</b> R startup</a><ul>
<li class="chapter" data-level="2.4.1" data-path="r-startup.html"><a href="r-startup.html#r-startup-arguments"><i class="fa fa-check"></i><b>2.4.1</b> R startup arguments</a></li>
<li class="chapter" data-level="2.4.2" data-path="r-startup.html"><a href="r-startup.html#an-overview-of-rs-startup-files"><i class="fa fa-check"></i><b>2.4.2</b> An overview of R’s startup files</a></li>
<li class="chapter" data-level="2.4.3" data-path="r-startup.html"><a href="r-startup.html#the-location-of-startup-files"><i class="fa fa-check"></i><b>2.4.3</b> The location of startup files</a></li>
<li class="chapter" data-level="2.4.4" data-path="r-startup.html"><a href="r-startup.html#rprofile"><i class="fa fa-check"></i><b>2.4.4</b> The <code>.Rprofile</code> file</a></li>
<li class="chapter" data-level="2.4.5" data-path="r-startup.html"><a href="r-startup.html#example-.rprofile-settings"><i class="fa fa-check"></i><b>2.4.5</b> Example <code>.Rprofile</code> settings</a></li>
<li class="chapter" data-level="2.4.6" data-path="r-startup.html"><a href="r-startup.html#renviron"><i class="fa fa-check"></i><b>2.4.6</b> The <code>.Renviron</code> file</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>2.5</b> RStudio</a><ul>
<li class="chapter" data-level="2.5.1" data-path="rstudio.html"><a href="rstudio.html#install-rstudio"><i class="fa fa-check"></i><b>2.5.1</b> Installing and updating RStudio</a></li>
<li class="chapter" data-level="2.5.2" data-path="rstudio.html"><a href="rstudio.html#window-pane-layout"><i class="fa fa-check"></i><b>2.5.2</b> Window pane layout</a></li>
<li class="chapter" data-level="2.5.3" data-path="rstudio.html"><a href="rstudio.html#exercises-3"><i class="fa fa-check"></i><b>2.5.3</b> Exercises</a></li>
<li class="chapter" data-level="2.5.4" data-path="rstudio.html"><a href="rstudio.html#rstudio-options"><i class="fa fa-check"></i><b>2.5.4</b> RStudio options</a></li>
<li class="chapter" data-level="2.5.5" data-path="rstudio.html"><a href="rstudio.html#auto-completion"><i class="fa fa-check"></i><b>2.5.5</b> Auto-completion</a></li>
<li class="chapter" data-level="2.5.6" data-path="rstudio.html"><a href="rstudio.html#keyboard-shortcuts"><i class="fa fa-check"></i><b>2.5.6</b> Keyboard shortcuts</a></li>
<li class="chapter" data-level="2.5.7" data-path="rstudio.html"><a href="rstudio.html#object-display-and-output-table"><i class="fa fa-check"></i><b>2.5.7</b> Object display and output table</a></li>
<li class="chapter" data-level="2.5.8" data-path="rstudio.html"><a href="rstudio.html#project-management"><i class="fa fa-check"></i><b>2.5.8</b> Project management</a></li>
<li class="chapter" data-level="2.5.9" data-path="rstudio.html"><a href="rstudio.html#exercises-4"><i class="fa fa-check"></i><b>2.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html"><i class="fa fa-check"></i><b>2.6</b> BLAS and alternative R interpreters</a><ul>
<li class="chapter" data-level="2.6.1" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#testing-performance-gains-from-blas"><i class="fa fa-check"></i><b>2.6.1</b> Testing performance gains from BLAS</a></li>
<li class="chapter" data-level="2.6.2" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#revolution-r"><i class="fa fa-check"></i><b>2.6.2</b> Revolution R</a></li>
<li class="chapter" data-level="2.6.3" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#other-interpreters"><i class="fa fa-check"></i><b>2.6.3</b> Other interpreters</a></li>
<li class="chapter" data-level="2.6.4" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#useful-blasbenchmarking-resources"><i class="fa fa-check"></i><b>2.6.4</b> Useful BLAS/benchmarking resources</a></li>
<li class="chapter" data-level="2.6.5" data-path="blas-and-alternative-r-interpreters.html"><a href="blas-and-alternative-r-interpreters.html#exercises-5"><i class="fa fa-check"></i><b>2.6.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programming.html"><a href="programming.html"><i class="fa fa-check"></i><b>3</b> Efficient programming</a><ul>
<li class="chapter" data-level="3.1" data-path="general-advice.html"><a href="general-advice.html"><i class="fa fa-check"></i><b>3.1</b> General advice</a><ul>
<li class="chapter" data-level="3.1.1" data-path="general-advice.html"><a href="general-advice.html#memory-allocation"><i class="fa fa-check"></i><b>3.1.1</b> Memory allocation</a></li>
<li class="chapter" data-level="3.1.2" data-path="general-advice.html"><a href="general-advice.html#vectorised-code"><i class="fa fa-check"></i><b>3.1.2</b> Vectorised code</a></li>
<li class="chapter" data-level="" data-path="general-advice.html"><a href="general-advice.html#exercise-1"><i class="fa fa-check"></i>Exercise</a></li>
<li class="chapter" data-level="3.1.3" data-path="general-advice.html"><a href="general-advice.html#type-consistency"><i class="fa fa-check"></i><b>3.1.3</b> Type consistency</a></li>
<li class="chapter" data-level="3.1.4" data-path="general-advice.html"><a href="general-advice.html#invisible-returns"><i class="fa fa-check"></i><b>3.1.4</b> Invisible returns</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>3.2</b> Factors</a><ul>
<li class="chapter" data-level="3.2.1" data-path="factors.html"><a href="factors.html#example-months-of-the-year"><i class="fa fa-check"></i><b>3.2.1</b> Example: Months of the year</a></li>
<li class="chapter" data-level="3.2.2" data-path="factors.html"><a href="factors.html#example-graphics"><i class="fa fa-check"></i><b>3.2.2</b> Example: Graphics</a></li>
<li class="chapter" data-level="3.2.3" data-path="factors.html"><a href="factors.html#example-analysis-of-variance"><i class="fa fa-check"></i><b>3.2.3</b> Example: Analysis of variance</a></li>
<li class="chapter" data-level="3.2.4" data-path="factors.html"><a href="factors.html#example-data-input"><i class="fa fa-check"></i><b>3.2.4</b> Example: data input</a></li>
<li class="chapter" data-level="3.2.5" data-path="factors.html"><a href="factors.html#example-factors-are-not-character-vectors"><i class="fa fa-check"></i><b>3.2.5</b> Example: Factors are not character vectors</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="S3.html"><a href="S3.html"><i class="fa fa-check"></i><b>3.3</b> S3 objects</a></li>
<li class="chapter" data-level="3.4" data-path="caching-variables.html"><a href="caching-variables.html"><i class="fa fa-check"></i><b>3.4</b> Caching variables</a><ul>
<li class="chapter" data-level="3.4.1" data-path="caching-variables.html"><a href="caching-variables.html#function-closures"><i class="fa fa-check"></i><b>3.4.1</b> Function closures</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="the-byte-compiler.html"><a href="the-byte-compiler.html"><i class="fa fa-check"></i><b>3.5</b> The byte compiler</a><ul>
<li class="chapter" data-level="3.5.1" data-path="the-byte-compiler.html"><a href="the-byte-compiler.html#example-the-mean-function"><i class="fa fa-check"></i><b>3.5.1</b> Example: the mean function</a></li>
<li class="chapter" data-level="3.5.2" data-path="the-byte-compiler.html"><a href="the-byte-compiler.html#compiling-code"><i class="fa fa-check"></i><b>3.5.2</b> Compiling code</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="parallel-computing.html"><a href="parallel-computing.html"><i class="fa fa-check"></i><b>3.6</b> Parallel computing</a><ul>
<li class="chapter" data-level="3.6.1" data-path="parallel-computing.html"><a href="parallel-computing.html#parallel-versions-of-apply-functions"><i class="fa fa-check"></i><b>3.6.1</b> Parallel versions of apply functions</a></li>
<li class="chapter" data-level="3.6.2" data-path="parallel-computing.html"><a href="parallel-computing.html#example-snakes-and-ladders"><i class="fa fa-check"></i><b>3.6.2</b> Example: Snakes and Ladders</a></li>
<li class="chapter" data-level="3.6.3" data-path="parallel-computing.html"><a href="parallel-computing.html#exit-functions-with-care"><i class="fa fa-check"></i><b>3.6.3</b> Exit functions with care</a></li>
<li class="chapter" data-level="3.6.4" data-path="parallel-computing.html"><a href="parallel-computing.html#process-forking"><i class="fa fa-check"></i><b>3.6.4</b> Process forking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="efficient-workflow.html"><a href="efficient-workflow.html"><i class="fa fa-check"></i><b>4</b> Efficient workflow</a><ul>
<li class="chapter" data-level="4.1" data-path="project-planning.html"><a href="project-planning.html"><i class="fa fa-check"></i><b>4.1</b> Project planning</a><ul>
<li class="chapter" data-level="4.1.1" data-path="project-planning.html"><a href="project-planning.html#chunking-your-work"><i class="fa fa-check"></i><b>4.1.1</b> ‘Chunking’ your work</a></li>
<li class="chapter" data-level="4.1.2" data-path="project-planning.html"><a href="project-planning.html#smart"><i class="fa fa-check"></i><b>4.1.2</b> Making your workflow SMART</a></li>
<li class="chapter" data-level="4.1.3" data-path="project-planning.html"><a href="project-planning.html#r-packages-for-planning"><i class="fa fa-check"></i><b>4.1.3</b> R packages for planning</a></li>
<li class="chapter" data-level="4.1.4" data-path="project-planning.html"><a href="project-planning.html#exercises-9"><i class="fa fa-check"></i><b>4.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="pkgs.html"><a href="pkgs.html"><i class="fa fa-check"></i><b>4.2</b> Package selection</a></li>
<li class="chapter" data-level="4.3" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>4.3</b> Importing data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="importing-data.html"><a href="importing-data.html#fread"><i class="fa fa-check"></i><b>4.3.1</b> Fast data reading</a></li>
<li class="chapter" data-level="4.3.2" data-path="importing-data.html"><a href="importing-data.html#preprocessing-outside-r"><i class="fa fa-check"></i><b>4.3.2</b> Preprocessing outside R</a></li>
<li class="chapter" data-level="4.3.3" data-path="importing-data.html"><a href="importing-data.html#working-with-databases"><i class="fa fa-check"></i><b>4.3.3</b> Working with databases</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="tidying-data-with-tidyr.html"><a href="tidying-data-with-tidyr.html"><i class="fa fa-check"></i><b>4.4</b> Tidying data with tidyr</a></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4.5</b> Data processing with dplyr</a><ul>
<li class="chapter" data-level="4.5.1" data-path="dplyr.html"><a href="dplyr.html#renaming-columns"><i class="fa fa-check"></i><b>4.5.1</b> Renaming columns</a></li>
<li class="chapter" data-level="4.5.2" data-path="dplyr.html"><a href="dplyr.html#changing-column-classes"><i class="fa fa-check"></i><b>4.5.2</b> Changing column classes</a></li>
<li class="chapter" data-level="4.5.3" data-path="dplyr.html"><a href="dplyr.html#filtering-rows"><i class="fa fa-check"></i><b>4.5.3</b> Filtering rows</a></li>
<li class="chapter" data-level="4.5.4" data-path="dplyr.html"><a href="dplyr.html#filtering-columns"><i class="fa fa-check"></i><b>4.5.4</b> Filtering columns</a></li>
<li class="chapter" data-level="4.5.5" data-path="dplyr.html"><a href="dplyr.html#data-aggregation"><i class="fa fa-check"></i><b>4.5.5</b> Data aggregation</a></li>
<li class="chapter" data-level="4.5.6" data-path="dplyr.html"><a href="dplyr.html#chaining-operations"><i class="fa fa-check"></i><b>4.5.6</b> Chaining operations</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-processing-with-data-table.html"><a href="data-processing-with-data-table.html"><i class="fa fa-check"></i><b>4.6</b> Data processing with data.table</a></li>
<li class="chapter" data-level="4.7" data-path="publication.html"><a href="publication.html"><i class="fa fa-check"></i><b>4.7</b> Publication</a><ul>
<li class="chapter" data-level="4.7.1" data-path="publication.html"><a href="publication.html#dynamic-documents-with-knitr"><i class="fa fa-check"></i><b>4.7.1</b> Dynamic documents with knitr</a></li>
<li class="chapter" data-level="4.7.2" data-path="publication.html"><a href="publication.html#r-packages"><i class="fa fa-check"></i><b>4.7.2</b> R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="efficient-data-capentry.html"><a href="efficient-data-capentry.html"><i class="fa fa-check"></i><b>5</b> Efficient data capentry</a></li>
<li class="chapter" data-level="6" data-path="efficient-visualisation.html"><a href="efficient-visualisation.html"><i class="fa fa-check"></i><b>6</b> Efficient visualisation</a><ul>
<li class="chapter" data-level="6.1" data-path="rough-outline.html"><a href="rough-outline.html"><i class="fa fa-check"></i><b>6.1</b> Rough outline</a></li>
<li class="chapter" data-level="6.2" data-path="cario-type.html"><a href="cario-type.html"><i class="fa fa-check"></i><b>6.2</b> Cario type</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="efficient-performance.html"><a href="efficient-performance.html"><i class="fa fa-check"></i><b>7</b> Efficient performance</a><ul>
<li class="chapter" data-level="7.1" data-path="efficient-base-r.html"><a href="efficient-base-r.html"><i class="fa fa-check"></i><b>7.1</b> Efficient base R</a><ul>
<li><a href="efficient-base-r.html#the-if-vs-ifelse-functions">The <code>if</code> vs <code>ifelse</code> functions</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#sorting-and-ordering"><i class="fa fa-check"></i>Sorting and ordering</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#reversing-elements"><i class="fa fa-check"></i>Reversing elements</a></li>
<li><a href="efficient-base-r.html#which-indices-are-true">Which indices are <code>TRUE</code>  </a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#converting-factors-to-numerics"><i class="fa fa-check"></i>Converting factors to numerics</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#string-concatenation"><i class="fa fa-check"></i>String concatenation</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#logical-and-and-or"><i class="fa fa-check"></i>Logical AND and OR</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#row-and-column-operations"><i class="fa fa-check"></i>Row and column operations</a></li>
<li class="chapter" data-level="7.1.1" data-path="efficient-base-r.html"><a href="efficient-base-r.html#is.na-and-anyna"><i class="fa fa-check"></i><b>7.1.1</b> <code>is.na</code> and <code class="unnumbered">anyNA</code></a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#matrices"><i class="fa fa-check"></i>Matrices</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#efficient-data-structures"><i class="fa fa-check"></i>Efficient data structures</a></li>
<li class="chapter" data-level="" data-path="efficient-base-r.html"><a href="efficient-base-r.html#the-integer-data-type"><i class="fa fa-check"></i>The integer data type</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="code-profiling.html"><a href="code-profiling.html"><i class="fa fa-check"></i><b>7.2</b> Code profiling</a><ul>
<li class="chapter" data-level="7.2.1" data-path="code-profiling.html"><a href="code-profiling.html#getting-started-with-profvis"><i class="fa fa-check"></i><b>7.2.1</b> Getting started with <strong>profvis</strong></a></li>
<li class="chapter" data-level="7.2.2" data-path="code-profiling.html"><a href="code-profiling.html#example-monopoly-simulation"><i class="fa fa-check"></i><b>7.2.2</b> Example: Monopoly Simulation</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>7.3</b> Rcpp</a><ul>
<li class="chapter" data-level="7.3.1" data-path="rcpp.html"><a href="rcpp.html#pre-requisites"><i class="fa fa-check"></i><b>7.3.1</b> Pre-requisites</a></li>
<li class="chapter" data-level="7.3.2" data-path="rcpp.html"><a href="rcpp.html#simple-c"><i class="fa fa-check"></i><b>7.3.2</b> A simple C++ function</a></li>
<li class="chapter" data-level="7.3.3" data-path="rcpp.html"><a href="rcpp.html#cppfunction"><i class="fa fa-check"></i><b>7.3.3</b> The cppFunction command</a></li>
<li class="chapter" data-level="7.3.4" data-path="rcpp.html"><a href="rcpp.html#c-types"><i class="fa fa-check"></i><b>7.3.4</b> C++ data types</a></li>
<li class="chapter" data-level="7.3.5" data-path="rcpp.html"><a href="rcpp.html#sourcecpp"><i class="fa fa-check"></i><b>7.3.5</b> The <code>sourceCpp</code> function</a></li>
<li class="chapter" data-level="7.3.6" data-path="rcpp.html"><a href="rcpp.html#vectors-and-loops"><i class="fa fa-check"></i><b>7.3.6</b> Vectors and loops</a></li>
<li class="chapter" data-level="7.3.7" data-path="rcpp.html"><a href="rcpp.html#sugar"><i class="fa fa-check"></i><b>7.3.7</b> C++ with sugar on top</a></li>
<li class="chapter" data-level="7.3.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-resources"><i class="fa fa-check"></i><b>7.3.8</b> Rcpp resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="efficient-hardware.html"><a href="efficient-hardware.html"><i class="fa fa-check"></i><b>8</b> Efficient hardware</a><ul>
<li class="chapter" data-level="8.1" data-path="background-what-is-a-byte.html"><a href="background-what-is-a-byte.html"><i class="fa fa-check"></i><b>8.1</b> Background: what is a byte?</a></li>
<li class="chapter" data-level="8.2" data-path="ram.html"><a href="ram.html"><i class="fa fa-check"></i><b>8.2</b> Random access memory: RAM</a></li>
<li class="chapter" data-level="8.3" data-path="hard-drives-hdd-vs-ssd.html"><a href="hard-drives-hdd-vs-ssd.html"><i class="fa fa-check"></i><b>8.3</b> Hard drives: HDD vs SSD</a></li>
<li class="chapter" data-level="8.4" data-path="operating-systems-32-bit-or-64-bit.html"><a href="operating-systems-32-bit-or-64-bit.html"><i class="fa fa-check"></i><b>8.4</b> Operating systems: 32-bit or 64-bit</a></li>
<li class="chapter" data-level="8.5" data-path="central-processing-unit-cpu.html"><a href="central-processing-unit-cpu.html"><i class="fa fa-check"></i><b>8.5</b> Central processing unit (CPU)</a></li>
<li class="chapter" data-level="8.6" data-path="cloud-computing.html"><a href="cloud-computing.html"><i class="fa fa-check"></i><b>8.6</b> Cloud computing</a><ul>
<li class="chapter" data-level="8.6.1" data-path="cloud-computing.html"><a href="cloud-computing.html#amazon-ec2"><i class="fa fa-check"></i><b>8.6.1</b> Amazon EC2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="efficient-collaboration.html"><a href="efficient-collaboration.html"><i class="fa fa-check"></i><b>9</b> Efficient Collaboration</a><ul>
<li class="chapter" data-level="9.1" data-path="coding-style.html"><a href="coding-style.html"><i class="fa fa-check"></i><b>9.1</b> Coding style</a><ul>
<li class="chapter" data-level="9.1.1" data-path="coding-style.html"><a href="coding-style.html#reformatting-code-with-rstudio"><i class="fa fa-check"></i><b>9.1.1</b> Reformatting code with RStudio</a></li>
<li class="chapter" data-level="9.1.2" data-path="coding-style.html"><a href="coding-style.html#file-names"><i class="fa fa-check"></i><b>9.1.2</b> File names</a></li>
<li class="chapter" data-level="9.1.3" data-path="coding-style.html"><a href="coding-style.html#loading-packages"><i class="fa fa-check"></i><b>9.1.3</b> Loading packages</a></li>
<li class="chapter" data-level="9.1.4" data-path="coding-style.html"><a href="coding-style.html#commenting"><i class="fa fa-check"></i><b>9.1.4</b> Commenting</a></li>
<li class="chapter" data-level="9.1.5" data-path="coding-style.html"><a href="coding-style.html#object-names"><i class="fa fa-check"></i><b>9.1.5</b> Object names</a></li>
<li class="chapter" data-level="9.1.6" data-path="coding-style.html"><a href="coding-style.html#example-package"><i class="fa fa-check"></i><b>9.1.6</b> Example package</a></li>
<li class="chapter" data-level="9.1.7" data-path="coding-style.html"><a href="coding-style.html#assignment"><i class="fa fa-check"></i><b>9.1.7</b> Assignment</a></li>
<li class="chapter" data-level="9.1.8" data-path="coding-style.html"><a href="coding-style.html#spacing"><i class="fa fa-check"></i><b>9.1.8</b> Spacing</a></li>
<li class="chapter" data-level="9.1.9" data-path="coding-style.html"><a href="coding-style.html#indentation"><i class="fa fa-check"></i><b>9.1.9</b> Indentation</a></li>
<li class="chapter" data-level="9.1.10" data-path="coding-style.html"><a href="coding-style.html#curly-braces"><i class="fa fa-check"></i><b>9.1.10</b> Curly braces</a></li>
<li class="chapter" data-level="9.1.11" data-path="coding-style.html"><a href="coding-style.html#exercises-17"><i class="fa fa-check"></i><b>9.1.11</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="efficient-learning.html"><a href="efficient-learning.html"><i class="fa fa-check"></i><b>10</b> Efficient Learning</a><ul>
<li class="chapter" data-level="10.1" data-path="using-r-help.html"><a href="using-r-help.html"><i class="fa fa-check"></i><b>10.1</b> Using R Help</a></li>
<li class="chapter" data-level="10.2" data-path="reading-r-source-code.html"><a href="reading-r-source-code.html"><i class="fa fa-check"></i><b>10.2</b> Reading R source code</a></li>
<li class="chapter" data-level="10.3" data-path="learning-online.html"><a href="learning-online.html"><i class="fa fa-check"></i><b>10.3</b> Learning online</a><ul>
<li class="chapter" data-level="10.3.1" data-path="learning-online.html"><a href="learning-online.html#reproducible-example"><i class="fa fa-check"></i><b>10.3.1</b> Reproducible example</a></li>
<li class="chapter" data-level="10.3.2" data-path="learning-online.html"><a href="learning-online.html#minimal-data-set"><i class="fa fa-check"></i><b>10.3.2</b> Minimal data set</a></li>
<li class="chapter" data-level="10.3.3" data-path="learning-online.html"><a href="learning-online.html#minimal-example"><i class="fa fa-check"></i><b>10.3.3</b> Minimal example</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="online-resources.html"><a href="online-resources.html"><i class="fa fa-check"></i><b>10.4</b> Online resources</a><ul>
<li class="chapter" data-level="10.4.1" data-path="online-resources.html"><a href="online-resources.html#stackoverflow"><i class="fa fa-check"></i><b>10.4.1</b> Stackoverflow</a></li>
<li class="chapter" data-level="10.4.2" data-path="online-resources.html"><a href="online-resources.html#mailing-lists-help-dev-package"><i class="fa fa-check"></i><b>10.4.2</b> Mailing lists: help, dev, package</a></li>
<li class="chapter" data-level="10.4.3" data-path="online-resources.html"><a href="online-resources.html#r-bloggers"><i class="fa fa-check"></i><b>10.4.3</b> r-bloggers</a></li>
<li class="chapter" data-level="10.4.4" data-path="online-resources.html"><a href="online-resources.html#twitter-rstats"><i class="fa fa-check"></i><b>10.4.4</b> twitter: <code>#rstats</code></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="conferences.html"><a href="conferences.html"><i class="fa fa-check"></i><b>10.5</b> Conferences</a><ul>
<li class="chapter" data-level="10.5.1" data-path="conferences.html"><a href="conferences.html#user"><i class="fa fa-check"></i><b>10.5.1</b> useR!</a></li>
<li class="chapter" data-level="10.5.2" data-path="conferences.html"><a href="conferences.html#local-groups"><i class="fa fa-check"></i><b>10.5.2</b> Local groups</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="code.html"><a href="code.html"><i class="fa fa-check"></i><b>10.6</b> Code</a></li>
<li class="chapter" data-level="10.7" data-path="look-at-the-source-code.html"><a href="look-at-the-source-code.html"><i class="fa fa-check"></i><b>10.7</b> Look at the source code</a><ul>
<li class="chapter" data-level="10.7.1" data-path="look-at-the-source-code.html"><a href="look-at-the-source-code.html#r-journal-and-journal-of-statistical-software"><i class="fa fa-check"></i><b>10.7.1</b> R-journal and Journal of Statistical Software</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="http://www.mas.ncl.ac.uk/~ncsg3/">Colin Gillespie</a>, Robin Lovelace</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Efficient R programming</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="general-advice" class="section level2">
<h2><span class="header-section-number">3.1</span> General advice</h2>
<p>C and Fortran demand more from the programmer. The coder must declare the type of every variable they use and has the burdensome responsible of memory management. The payback is that it allows the compiler to better predict how the program behaves and so make clever optimisations.</p>
<div class="rmdnote">
<p>
The wikipedia page on compiler opimisations gives a nice overview of standard optimisation techniques (<a href="https://en.wikipedia.org/wiki/Optimizing_compiler" class="uri">https://en.wikipedia.org/wiki/Optimizing_compiler</a>).
</p>
</div>
<p>In R we don’t (tend to) worry about data types. However this means that it’s possible to write R programs that are incredibly slow. While optimisations such as going parallel can double speed, poor code can easily run 100’s of times slower. If you spend any time programming in R, then <span class="citation">(Burns <a href="#ref-Burns2011">2011</a>)</span> should be considered essential reading.</p>
<p>Ultimately calling an R function always ends up calling some underlying C/Fortran code. For example the base R function <code>runif</code> only contains a single line that consists of a call to <code>C_runif</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">function (n, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>) 
  <span class="kw">.Call</span>(C_runif, n, min, max)</code></pre></div>
<p>The <strong>golden rule</strong> in R programming is to access the underlying C/Fortran routines as quickly as possible; the fewer functions calls required to achieve this, the better. For example, suppose <code>x</code> is a standard vector of length <code>n</code>. Then</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span>x +<span class="st"> </span><span class="dv">1</span></code></pre></div>
<p>involves a single function call to the <code>+</code> function. Whereas the <code>for</code> loop</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for(i in <span class="dv">1</span>:n) 
  x[i] =<span class="st"> </span>x[i] +<span class="st"> </span><span class="dv">1</span> </code></pre></div>
<p>has</p>
<ul>
<li><code>n</code> function calls to <code>+</code>;</li>
<li><code>n</code> function calls to the <code>[</code> function;</li>
<li><code>n</code> function calls to the <code>[&lt;-</code> function (used in the assignment operation);</li>
<li>A function call to <code>for</code> and to the <code>:</code> operator.</li>
</ul>
<p>It isn’t that the <code>for</code> loop is slow, rather it is because we have many more function calls. Each individual function call is quick, but the total combination is slow.</p>
<div class="rmdnote">
<p>
Everything in R is a function call. When we execute <code>1 + 1</code>, we are actually exercuting <code>+(1, 1)</code>.
</p>
</div>
<div id="exercise" class="section level4 unnumbered">
<h4>Exercise</h4>
<p>Use the <code>rbenchmark</code> package to compare the vectorised construct <code>x = x + 1</code>, to the <code>for</code> loop version. Try varying the size of the input vector.</p>
</div>
<div id="memory-allocation" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Memory allocation</h3>
<p>Another general technique is to be careful with memory allocation. If possible pre-allocate your vector then fill in the values.</p>
<div class="rmdtip">
<p>
You should also consider pre-allocating memory for data frames and lists. Never grow an object. A good rule of thumb is to compare your objects before and after a <code>for</code> loop; have they increased in length?
</p>
</div>
<p>Let’s consider three methods of creating a sequence of numbers. <strong>Method 1</strong> creates an empty vector and grows the object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">method1 =<span class="st"> </span>function(n) {
  vec =<span class="st"> </span><span class="ot">NULL</span> <span class="co"># Or vec = c()</span>
  for(i in <span class="dv">1</span>:n)
    vec =<span class="st"> </span><span class="kw">c</span>(vec, i)
  vec
}</code></pre></div>
<p><strong>Method 2</strong> creates an object of the final length and then changes the values in the object by subscripting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">method2 =<span class="st"> </span>function(n) {
  vec =<span class="st"> </span><span class="kw">numeric</span>(n)
  for(i in <span class="dv">1</span>:n)
    vec[i] =<span class="st"> </span>i
  vec
}</code></pre></div>
<p><strong>Method 3</strong> directly creates the final object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">method3 =<span class="st"> </span>function(n) <span class="dv">1</span>:n</code></pre></div>
<p>To compare the three methods we use the <code>benchmark</code> function from the previous chapter</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n =<span class="st"> </span><span class="fl">1e4</span>
rbenchmark::<span class="kw">benchmark</span>(<span class="dt">replications=</span><span class="dv">10</span>, 
          <span class="kw">method1</span>(n), <span class="kw">method2</span>(n), <span class="kw">method3</span>(n),
          <span class="dt">columns=</span><span class="kw">c</span>(<span class="st">&quot;test&quot;</span>, <span class="st">&quot;elapsed&quot;</span>))
<span class="co">#&gt;         test elapsed</span>
<span class="co">#&gt; 1 method1(n)   1.560</span>
<span class="co">#&gt; 2 method2(n)   0.094</span>
<span class="co">#&gt; 3 method3(n)   0.000</span></code></pre></div>
<p>The table below shows the timing in seconds on my machine for these three methods for a selection of values of <code>n</code>. The relationships for varying <code>n</code> are all roughly linear on a log-log scale, but the timings between methods are drastically different. Notice that the timings are no longer trivial. When <span class="math inline">\(n=10^7\)</span>, method <span class="math inline">\(1\)</span> takes around an hour whilst method <span class="math inline">\(2\)</span> takes <span class="math inline">\(2\)</span> seconds and method <span class="math inline">\(3\)</span> is almost instantaneous. Remember the golden rule; access the underlying C/Fortran code as quickly as possible.</p>
<table>
<caption>Time in seconds to create sequences. When <span class="math inline">\(n=10^7\)</span>, method <span class="math inline">\(1\)</span> takes around an hour while the other methods take less than 3 seconds.</caption>
<thead>
<tr class="header">
<th align="left"><span class="math inline">\(n\)</span></th>
<th align="left">Method 1</th>
<th align="left">Method 2</th>
<th align="left">Method 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(10^5\)</span></td>
<td align="left"><span class="math inline">\(\phantom{000}0.21\)</span></td>
<td align="left"><span class="math inline">\(0.02\)</span></td>
<td align="left"><span class="math inline">\(0.00\)</span></td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(10^6\)</span></td>
<td align="left"><span class="math inline">\(\phantom{00}25.50\)</span></td>
<td align="left"><span class="math inline">\(0.22\)</span></td>
<td align="left"><span class="math inline">\(0.00\)</span></td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(10^7\)</span></td>
<td align="left"><span class="math inline">\(3827.00\)</span></td>
<td align="left"><span class="math inline">\(2.21\)</span></td>
<td align="left"><span class="math inline">\(0.00\)</span></td>
</tr>
</tbody>
</table>
</div>
<div id="vectorised-code" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Vectorised code</h3>
<p>The vector is one of the key data types in R, with many functions offering a vectorised version. For example, the code</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">runif</span>(n) +<span class="st"> </span><span class="dv">1</span></code></pre></div>
<p>performs two vectorised operations. First <code>runif</code> returns <code>n</code> random numbers. Second we add <code>1</code> to each element of the vector. In general it is a good idea to exploit vectorised functions. Consider this piece of R code that calculates the sum of <span class="math inline">\(\log(x)\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">log_sum =<span class="st"> </span><span class="dv">0</span>
for(i in <span class="dv">1</span>:<span class="kw">length</span>(x))
  log_sum =<span class="st"> </span>logsum +<span class="st"> </span><span class="kw">log</span>(x[i])</code></pre></div>
<div class="rmdwarning">
<p>
Using <code>1:length(x)</code> can lead to hard-to-find bugs when <code>x</code> has length zero. Instead use <code>seq_along(x)</code> or <code>seq_leng(length(x))</code>.
</p>
</div>
<p>This code could easily be vectorised via</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">log_sum =<span class="st"> </span><span class="kw">sum</span>(<span class="kw">log</span>(x))</code></pre></div>
<p>Writing code this way has a number of benefits.</p>
<ul>
<li>It’s faster. When <span class="math inline">\(n = 10^7\)</span> the ``R way’’ is about forty times faster.</li>
<li>It’s neater.</li>
<li>It doesn’t contain a bug when <code>x</code> is of length <span class="math inline">\(0\)</span>.</li>
</ul>
<div id="exercises-6" class="section level4 unnumbered">
<h4>Exercises</h4>
<p>Time the two methods for calculating the log sum. Try different values of <span class="math inline">\(n\)</span>.</p>
</div>
<div id="example-monte-carlo-integration" class="section level4 unnumbered">
<h4>Example: Monte-Carlo integration</h4>
<p>It’s also important to make full use of R functions that use vectors. For example, suppose we wish to estimate the integral <span class="math display">\[
\int_0^1 x^2 dx
\]</span> using a Monte-Carlo method. Essentially, we throw darts at the curve and count the number of darts that fall below the curve (as in <a href="general-advice.html#fig:6-2">3.1</a>).</p>
<p><em>Monte Carlo Integration</em></p>
<ol style="list-style-type: decimal">
<li>Initialise: <code>hits = 0</code></li>
<li><strong>for i in 1:N</strong></li>
<li><span class="math inline">\(~~~\)</span> Generate two random numbers, <span class="math inline">\(U_1, U_2\)</span>, between 0 and 1</li>
<li><span class="math inline">\(~~~\)</span> If <span class="math inline">\(U_2 &lt; U_1^2\)</span>, then <code>hits = hits + 1</code></li>
<li><strong>end for</strong></li>
<li>Area estimate = <code>hits/N</code></li>
</ol>
<p>Implementing this Monte-Carlo algorithm in R would typically lead to something like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">monte_carlo =<span class="st"> </span>function(N){
  hits =<span class="st"> </span><span class="dv">0</span>
  for(i in <span class="dv">1</span>:N)  {
    u1 =<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>); u2 =<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)
    if(u1^<span class="dv">2</span> &gt;<span class="st"> </span>u2)
      hits =<span class="st"> </span>hits +<span class="st"> </span><span class="dv">1</span>
  }
  <span class="kw">return</span>(hits/N)
}</code></pre></div>
<p>In R this takes a few seconds</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N =<span class="st"> </span><span class="dv">500000</span>
<span class="kw">system.time</span>(<span class="kw">monte_carlo</span>(N))
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   3.021   0.007   3.030</span></code></pre></div>
<p>In contrast a more R-centric approach would be</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">monte_carlo_vec =<span class="st"> </span>function(N) <span class="kw">sum</span>(<span class="kw">runif</span>(N)^<span class="dv">2</span> &gt;<span class="st"> </span><span class="kw">runif</span>(N))/N</code></pre></div>
<p>The <code>monte_carlo_vec</code> function contains (at least) four aspects of vectorisation</p>
<ul>
<li>The <code>runif</code> function call is now fully vectorised;</li>
<li>We raise entire vectors to a power via <code>^</code>;</li>
<li>Comparisons using <code>&gt;</code> are vectorised;</li>
<li>Using <code>sum</code> is quicker than an equivalent for loop.</li>
</ul>
The function <code>monte_carlo_vec</code> is around <span class="math inline">\(30\)</span> times faster than <code>monte_carlo</code>.
<div class="figure" style="text-align: center"><span id="fig:6-2"></span>
<img src="_main_files/figure-html/6-2-1.png" alt="Example of Monte-Carlo integration. To estimate the area under the curve throw random points at the graph and count the number of points that lie under the curve." width="576" />
<p class="caption">
Figure 3.1: Example of Monte-Carlo integration. To estimate the area under the curve throw random points at the graph and count the number of points that lie under the curve.
</p>
</div>
</div>
</div>
<div id="exercise-1" class="section level3 unnumbered">
<h3>Exercise</h3>
<p>Verify that <code>monte_carlo_vec</code> is faster than <code>monte_carlo</code>. How does this relate to the number of darts, i.e. the size of <code>N</code>, that is used</p>
</div>
<div id="type-consistency" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Type consistency</h3>
<p>When programming it is helpful if the return value from a function always takes the same form. Unfortunately, not all of base R functions follow this idiom. For example the functions <code>sapply</code> and <code>[.data.frame</code> aren’t type consistent</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">two_cols =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">y =</span> letters[<span class="dv">1</span>:<span class="dv">5</span>])
zero_cols =<span class="st"> </span><span class="kw">data.frame</span>()
<span class="kw">sapply</span>(two_cols, class)  <span class="co"># a character vector</span>
<span class="kw">sapply</span>(zero_cols, class) <span class="co"># a list</span>
two_cols[, <span class="dv">1</span>:<span class="dv">2</span>]          <span class="co"># a data.frame</span>
two_cols[, <span class="dv">1</span>]            <span class="co"># an integer vector</span></code></pre></div>
<p>This can cause unexpected problems. The functions <code>lapply</code> and <code>vapply</code> are type consistent. Likewise <code>dplyr::select</code> and <code>dplyr:filter</code>. The <strong>purrr</strong> package has some type consistent alternatives to base R functions. For example, <code>map_dbl</code> etc. to replace <code>Map</code> and <code>flatten_df</code> to replace <code>unlist</code>.</p>
<div id="exercises-7" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li><p>Rewrite the <code>sapply</code> function calls above using <code>vapply</code> to ensure type consistency.</p></li>
<li><p>How would you make subsetting data frames with <code>[</code> type consistent? Hint: look at the <code>drop</code> argument.</p></li>
</ol>
</div>
</div>
<div id="invisible-returns" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Invisible returns</h3>
<p>The <code>invisible</code> function allows you to return a temporarily invisible copy of an object. This is particularly useful for functions that return values which can be assigned, but are not printed when they are not assigned. For example suppose we have a function that plots the data and fits a straight line</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">regression_plot =<span class="st"> </span>function(x, y, ...) {
  <span class="kw">plot</span>(x, y, ...)
  model =<span class="st"> </span><span class="kw">lm</span>(y ~<span class="st"> </span>x)
  <span class="kw">abline</span>(model)
  <span class="kw">invisible</span>(model)
}</code></pre></div>
<p>When the function is called, a scatter graph is ploted with the line of best fit, but the output is invisible. However when we assign the function to an object, i.e. <code>out = regression_plot(x, y)</code> the variable <code>out</code> contains the output of the <code>lm</code> call.</p>
<p>Another example is <code>hist</code>. Typically we don’t want anything displayed in the console when we call the function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(x)</code></pre></div>
<p>However if we assign the output to an object, <code>out = hist(x)</code>, the object <code>out</code> is actually a list containing, <em>inter alia</em>, information on the mid-points, breaks and counts.</p>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Burns2011">
<p>Burns, Patrick. 2011. <em>The R Inferno</em>. Lulu.com.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="programming.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="factors.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/csgillespie/efficientR/edit/master/03-programming.Rmd",
"text": "Edit"
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
